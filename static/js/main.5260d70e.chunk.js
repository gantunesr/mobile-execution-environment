(this["webpackJsonpmobile-execution-environment"]=this["webpackJsonpmobile-execution-environment"]||[]).push([[0],{45:function(e,t,n){},56:function(e,t){},73:function(e,t,n){},75:function(e,t,n){"use strict";n.r(t);var o=n(1),r=n.n(o),i=n(35),a=n.n(i),s=(n(45),n(2)),c=n(8),d=n(36),u=n(17),l=n(20),g=n(18),b=n(38),w=n(37),v=n(19),f="ping",p="executeSnap",m="snapRpc",h="terminate",j="jsonRpc",O="window.postMessage is not a function. This class should only be instantiated in a Window.",_=function(e){Object(b.a)(n,e);var t=Object(w.a)(n);function n(e){var o,r=e.name,i=e.target,a=e.targetOrigin,s=void 0===a?window.location.origin:a,c=e.targetWindow,d=void 0===c?window:c;if(Object(u.a)(this,n),(o=t.call(this))._name=void 0,o._target=void 0,o._targetOrigin=void 0,o._targetWindow=void 0,"undefined"===typeof window||"function"!==typeof window.postMessage)throw new Error(O);return o._name=r,o._target=i,o._targetOrigin=s,o._targetWindow=d,o._onMessage=o._onMessage.bind(Object(g.a)(o)),window.addEventListener("message",o._onMessage,!1),o._handshake(),o}return Object(l.a)(n,[{key:"_postMessage",value:function(e){console.log("[ProxyMessageStream LOG] ProxyService returning result to RN App",e),this._targetWindow.postMessage(JSON.stringify({target:this._target,data:e}),this._targetOrigin)}},{key:"_onMessage",value:function(e){if(""===e.origin){var t=JSON.parse(e.data);t.target===this._name&&(console.log("[ProxyMessageStream LOG] ProxyService sending message to iframe",t.data),this._onData(t.data))}}},{key:"_destroy",value:function(){window.removeEventListener("message",this._onMessage,!1)}}]),n}(v.BasePostMessageStream),x=Object(l.a)((function e(t){var n=this,o=t.proxyService;Object(u.a)(this,e),this._jobs=void 0,this._proxyService=void 0,this._createWindow=function(e){return new Promise((function(t,n){var o=document.createElement("iframe");o.setAttribute("id",e),o.setAttribute("src","https://metamask.github.io/iframe-execution-environment/0.11.1"),document.body.appendChild(o),o.addEventListener("load",(function(){o.contentWindow?t(o.contentWindow):n(new Error('iframe.contentWindow not present on load for job "'.concat(e,'".')))})),o.setAttribute("sandbox","allow-scripts")}))},this._deleteWindow=function(e){var t=document.getElementById(e);if(!t||!t.parentNode)throw new Error("Window with the id ".concat(e," was not found"));t.parentNode.removeChild(t)},this._initJobStream=function(){var e=Object(c.a)(Object(s.a)().mark((function e(t){var o,r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n._createWindow(t);case 2:return o=e.sent,console.log({window:o}),r=new v.WindowPostMessageStream({name:"parent",target:"child",targetWindow:o,targetOrigin:"*"}),console.log({stream:r}),r.on("data",(function(e){console.log("ExecutionController ->",e),n._proxyService.write({data:e,jobId:t}),n._handleJobDeletion({data:e,jobId:t})})),e.abrupt("return",{id:t,window:o,stream:r});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this._update=function(e){n._jobs[e.id]=e,console.log("[ExecutionController LOG] updateJobsState:",{newState:n._jobs,newElelment:e})},this._handleJobDeletion=function(e){var t,o,r=e.jobId,i=e.data,a=n.get(r);console.log("ExecutionController ->",null===a||void 0===a?void 0:a.terminateNext,null===i||void 0===i||null===(t=i.data)||void 0===t?void 0:t.id),null!==a&&void 0!==a&&a.terminateNext&&(null===a||void 0===a?void 0:a.terminateNext)===(null===i||void 0===i||null===(o=i.data)||void 0===o?void 0:o.id)&&n.delete(r)},this.init=function(){var e=Object(c.a)(Object(s.a)().mark((function e(t){var o;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[ExecutionController LOG] initJob: Start new job"),e.next=3,n._initJobStream(t);case 3:o=e.sent,n._update(o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.get=function(e){var t=n._jobs[e];return console.log("[ExecutionController LOG] getJob:",{jobId:e,job:t}),t},this.delete=function(e){console.log("[ExecutionController LOG] delete:",{jobId:e}),n._jobs[e].stream._destroy(),console.log("[ExecutionController LOG] stream deleted:",{jobId:e}),n._deleteWindow(e),console.log("[ExecutionController LOG] iframe deleted:",{jobId:e}),delete n._jobs[e],console.log("[ExecutionController LOG] job deleted from state:",{jobId:e})},this._jobs={},this._proxyService=o})),y=(n(73),n(5));var E=function(){var e=Object(o.useState)(),t=Object(d.a)(e,2),n=t[0],r=t[1];return Object(o.useEffect)((function(){var e=new _({name:"webview",target:"rnside",targetOrigin:"*",targetWindow:window.ReactNativeWebView});r(e)}),[]),Object(o.useEffect)((function(){if(n){console.log("[WEB APP LOG] Subscribe to events originated on the RN App");var e=new x({proxyService:n});n.on("data",function(){var t=Object(c.a)(Object(s.a)().mark((function t(n){var o,r,i,a,c;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("[WEB APP LOG] Proxy receiving data - ",n),o=n.data.data,r=o.method,i=o.id,a=n.jobId,t.t0=r,t.next=t.t0===f?5:t.t0===h?11:t.t0===p?16:t.t0===m?19:t.t0===j?22:25;break;case 5:return console.log(e.jobs),t.next=8,e.init(a);case 8:return(c=e.get(a)).stream.write(n.data),t.abrupt("return");case 11:return console.log("[WEB APP LOG] Terminate job",n.data,a,i),(c=e.get(a)).stream.write(n.data),c.terminateNext=i,t.abrupt("return");case 16:case 19:case 22:return(c=e.get(a)).stream.write(n.data),t.abrupt("return");case 25:(c=e.get(a)).stream.write(n.data),console.log("Default case");case 28:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}),[n]),Object(y.jsx)("div",{className:"App",children:Object(y.jsx)("p",{children:"deploy 1"})})},S=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,76)).then((function(t){var n=t.getCLS,o=t.getFID,r=t.getFCP,i=t.getLCP,a=t.getTTFB;n(e),o(e),r(e),i(e),a(e)}))};a.a.createRoot(document.getElementById("root")).render(Object(y.jsx)(r.a.StrictMode,{children:Object(y.jsx)(E,{})})),S()}},[[75,1,2]]]);
//# sourceMappingURL=main.5260d70e.chunk.js.map